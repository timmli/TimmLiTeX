%%%%%%%%%%%%%%%%%%%%%%%%
%   PDFLATEX SETTINGS  % 
%%%%%%%%%%%%%%%%%%%%%%%%

%%   Font & Encoding

% \usepackage{libertine} % libertine tends to cause problems, e.g. when using tipa
% \usepackage[libertine]{newtxmath}
\usepackage{times}

\makeatletter

\@ifclassloaded{beamer}{
  \usepackage{libertine} % libertine tends to cause problems, e.g. when using tipa
  \usepackage[libertine]{newtxmath}}{}

\@ifclassloaded{tikzposter}{
  \usepackage{DejaVuSans} 
  \renewcommand*{\familydefault}{\sfdefault}}{}

\makeatother

\usepackage[scaled=0.8]{beramono}  % for monospaced font
\usepackage{microtype}		% micro-typographic aspects of the fonts
\usepackage[T1]{fontenc}	% special fonts, e.g. for German umlaute

%% compatible with BibLaTeX
\usepackage[utf8]{inputenc}
%% incompabtible with BibLaTeX
% \usepackage{ucs}
% \usepackage[utf8x]{inputenc}

%% Language
%\usepackage{german} % is this useful anymore?
\usepackage[german,english]{babel} % the last language in the options is loaded; the other one can be chosen with \selectlanguage
\usepackage{iflang}                % for language specific settings

\usepackage{etex} 
\usepackage{graphics}

\input{packages/tikz-settings}

%%%%%%%%%%%%%%%%%%%%%%% 
%   FOREST SETTINGS   % 
%%%%%%%%%%%%%%%%%%%%%%% 

\usepackage{forest}

\makeatletter

\@ifpackagelater{forest}{2016/01/01}
{\useforestlibrary{linguistics}%
 \useforestlibrary{edges}}
{}

\@ifpackagelater{forest}{2016/01/01}
{\newcommand{\forestPreamble}{default preamble}} % version >=2 of forest
{\newcommand{\forestPreamble}{.style}} % version <=1 of forest

\makeatother

\forestset{
  \forestPreamble ={
    % .style={ % version <=1 of forest
    % default preamble={ % version >=2 of forest    
		for tree={
			parent anchor=south, 
			child anchor=north,
			% align=center,			% bad: adds space below label
			fit=rectangle,
			base=top,				% vertical orientation of nodes
			% inner sep=3,			% necesssary?
			begin draw/.code={\begin{tikzpicture}[baseline=(current bounding box.center)]},
    }},
  htree/.style={for tree={grow'=east,parent anchor=east,child anchor=west,anchor=base west}},
  sn edges/.style={for tree={parent anchor=south, child anchor=north}},
  red subtree/.style={for tree={text=red},for descendants={edge=red}},
  black subtree/.style={for tree={text=black},for descendants={edge=black}},
  blue subtree/.style={for tree={text=blue},for descendants={edge=blue}},
  green subtree/.style={for tree={text=green},for descendants={edge=green}},
  gray subtree/.style={for tree={text=gray},for descendants={edge=gray}},
  color subtree/.style={for tree={text=#1},for descendants={edge={draw=#1}}},
  subtree color/.style={for tree={text=#1},for descendants={edge={draw=#1}}},
  vcenter/.style={begin draw/.code={\begin{tikzpicture}[baseline=(current bounding box.center)]}},
  empty nodes/.style={	% from the forest manual
    for tree={
      % calign=fixed edge angles,
      yshift=1ex},
    delay={where content={}{shape=coordinate,for parent={for children={anchor=north}}}{}}},
  derivation tree/.style={.style={
      for tree={parent anchor={},child anchor={},font=\ttfamily}}},
  derivation/.style={for children={fit=tight}},
  description/.style={
    for tree={parent anchor={},child anchor={},edge=->}},
  dt label/.style 2 args={
    edge label={node[midway,font=\ttfamily\scriptsize, #1]{#2}},},
  %% for drawing STUG sequences
  %% conn, <-- and --> are take from https://tex.stackexchange.com/a/414444/61499
  conn/.style n args=2{
    tikz+={\draw [dashed] (#1) -- (#2);}},
  -->/.style={ % draw horizontal line to predecessor
    before drawing tree={
      temptoksa=,
      tempcounta/.option=level,
      if nodewalk valid={n}{conn={}{!n}}{
        for nodewalk={
          while nodewalk valid={u}{
            tempcountb/.option=n,
            u,
            if={> OR>{n children}{tempcountb} }{
              tempcountc/.register=tempcountb,
              tempcountc'+=1,
              n/.register=tempcountc,
              while nodewalk valid={1}{
                1,
                if={ > OR= {level}{tempcounta} }{
                  temptoksa/.option=name,
                  break=1
                }{}
              }
            }{}
          }
        }{},
        if temptoksa={}{}{conn/.process={_R {}{temptoksa}}}
      },
    },
  },
  <--/.style={ % draw horizontal line to successor
    before drawing tree={
      temptoksa=,
      tempcounta/.option=level,
      if nodewalk valid={p}{conn={}{!p}}{
        for nodewalk={
          while nodewalk valid={u}{
            u,
            if n=1{}{
              p,
              while nodewalk valid={last}{
                last,
                if={ > OR= {level}{tempcounta} }{
                  temptoksa/.option=name,
                  break=1
                }{}
              }
            },
          }
        }{},
        if temptoksa={}{}{conn/.process={_R {}{temptoksa}}}
      },
    },
  },
  t/.style={calign with current}, % trunk 
  lex/.style={                    % terminal nodes with lexical material
    no edge,
    for parent={l sep=0ex},
    yshift=3ex,
    draw=gray,
    content={\textit{##1}}},
  c/.style args={#1}{            % visual link with argument
    % edge label={node[xshift={0.8em},scale=0.8,fill=white,draw,inner sep=.10ex,circle]{#1}}
    % tikz={\node[yshift={1.5ex},scale=0.8,fill=white,draw,inner sep=.10ex,circle, right=-0.5em of .east]  {1};}
    label={[yshift={0.5ex},scale=.8,circle, draw, fill=white, inner sep=.1ex, label distance=-.65em, anchor=west]north east:#1}},
  Xs/.style={for tree={xshift=#1}},
  Ys/.style={for tree={yshift=#1}},
  %% Beamer overlays (https://tex.stackexchange.com/a/253384/61499)
  invisible/.style={%
    for tree={%
      /tikz/invisible={#1},
      edge={/tikz/invisible={#1}}}},
  visible/.style={%
    for tree={%
      /tikz/visible={#1},
      edge={/tikz/visible={#1}}}},
  visible ancestors/.style={%
    edge={/tikz/visible={#1}},
    for ancestors={%
      /tikz/visible={#1},
      edge={/tikz/visible={#1}}}},
  opaque/.style={%
    for tree={%
      /tikz/opaque={#1},
      edge={/tikz/opaque={#1}}}},
  alert/.style={%
    for tree={%
      /tikz/alert={#1},
      edge={/tikz/alert={#1}}}},
  only/.code args={<#1>}{% https://tex.stackexchange.com/a/417110/61499
    \alt<#1>{}{\pgfkeysalso{before typesetting nodes={remove}}}},
  unify children/.style={
    if nodewalk valid={1}{
      l sep=5pt,
      for children={l=0mm},
      for nodewalk={1}{
        for siblings={no edge},
        edge={decorate, decoration={brace, amplitude=5pt}},
        edge path'={(!u1.west |- .north) -- (!ul.east |- .north)}
      }}{}}
}



\usepackage{url}
\usepackage{amsmath,amssymb,amsfonts,marvosym}
\usepackage{ulem}			% to cross out text
\normalem

\usepackage{ragged2e}
\let\raggedright=\RaggedRight

% \usepackage{tipa}
\usepackage{linguex}   % must be loaded below \usepackage[T1]{fontenc}
\AtBeginDocument{
  \setlength{\Exlabelsep}{0em}		% for linguex examples
  \setlength{\SubExleftmargin}{1,5em}	% for linguex examples
  \renewcommand\eachwordone{\sffamily}	% for glossing with linguex
  \renewcommand\eachwordtwo{\sffamily}	% for glossing with linguex
  % \setlength{\Extopsep}{1ex}   % vertical margin in linguex examples
}

\usepackage{packages/langsci-avm}

%%%%%%%%%%%%%%%%%%%%%%%% 
%  LISTINGS SETTINGS   % 
%%%%%%%%%%%%%%%%%%%%%%%% 

\usepackage{listings}

\lstset{basicstyle=\ttfamily,tabsize=2,breaklines=true}
\usepackage{color}
\definecolor{lightgray}{gray}{0.7}

%% Add syntax highlighting for specific programming languages
% \input{packages/listings-xmg-settings.tex} 



%% Bibliography

%%%%%%%%%%%%%%%%%%%%%%%% 
% BIBLATEX SETTINGS  % 
%%%%%%%%%%%%%%%%%%%%%%%% 

\newcommand{\mycitestyle}{muss}
\newcommand{\mybibstyle}{muss}

\makeatletter
\@ifclassloaded{beamer}{\renewcommand{\mycitestyle}{numeric-comp}}{}
\@ifclassloaded{tikzposter}{\renewcommand{\mycitestyle}{numeric-comp}}{}
\makeatother

\usepackage[
  bibstyle=\mybibstyle,
  citestyle=\mycitestyle,
  %% The remaining options are set in muss.bbx.
  % natbib=true,
  % refsection=chapter,
  % maxbibnames=99,
  % isbn=false,
  % doi=false,
  % eprint=false,
  % backend=biber,
  % sorting=ydnt,  % sort in descending chronological order
  % indexing=cite,
  % labelnumber,  % for numeric bibliography in beamer
  % toc=bib    % make bibliography appear in toc, incompatible with beamer
  ]{biblatex}
\renewcommand{\postnotedelim}{: }%
\renewcommand{\multicitedelim}{\addsemicolon\space}%
\renewcommand{\compcitedelim}{\multicitedelim}%
\DeclareFieldFormat{postnote}{#1}%

%% The bibliography file is specified like this
\addbibresource[datatype=bibtex]{references.bib}

\newcommand{\insertBib}{
  \printbibliography[
    % notkeyword=this
    ] 
}

% % Compat definitions to make available BibTeX macros in BibLaTeX 
% \let\citealt=\cite
% \let\cite=\textcite
% \let\citep=\parencite
% \let\citet=\cite
% \newcommand{\citeauthoryear}[1]{\citeauthor{#1} (\citeyear{#1})}
% \newcommand{\citealtauthoryear}[1]{\citeauthor{#1} \citeyear{#1}}



%% BibTeX 
% \input{settings/natbib_bibtex_setup.tex} 
% \PassOptionsToPackage{round}{natbib}
% \renewcommand{\newblock}{}    % to make natbib compatible with beamer

%%%%%%%%%%%%%%%%%%%%%%%%%
%   TEXTPOS SETTINGS    % 
%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{calc} % Enables the use of calc expressions: 0pt+1cm
\usepackage[
  absolute, % Absolute positioning
  overlay   % Positioned textblocks will overlay any other parts of the text.  
]{textpos}

\setlength{\TPHorizModule}{1em}
\setlength{\TPVertModule}{1ex}
\newlength{\textposOriginH}
\newlength{\textposOriginV}
\setlength{\textposOriginH}{10mm}
\setlength{\textposOriginV}{10mm}
\textblockorigin{\textposOriginH}{\textposOriginV}

\newcommand{\freeblock}[2]{
  \begin{textblock}{0.1}(#1)
  #2
  \end{textblock}
}
